<!DOCTYPE HTML>
<html>
	<head>
		<title>Test</title>
		<script src="ob/prototype.js" type="text/javascript" charset="utf-8"></script>
		<script src="ob/ob.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			ob.load("ob.gui.Button");
			ob.load("ob.gui.Menu");
			ob.load("ob.gui.TextField");
			ob.load("ob.ImageView");
			ob.load("ob.gui.ScrollBar");
			ob.load("ob.gui.Copier");
			//ob.load("ob.Debug");
			
			window.WeirdView=Class.create(OBView,{
				redraw:function(){
					this.ctx.fillStyle="black";
					this.ctx.fillRect(0,0,this.attr('width'),this.attr('height'));
					this.ctx.strokeStyle="blue";
					this.ctx.lineWidth=50;
					this.ctx.strokeRect(0,0,this.attr('width'),this.attr('height'));
				}//,
				//mouseover:function(){console.info("mouseover");},
				//mouseout:function(){console.info("mouseout");}
			});
			window.Clicker=Class.create(OBView,{
				setup:function(){
					this.points=[];
				},
				redraw:function(){
					this.ctx.strokeStyle=OBColor.Yellow.toString();
					this.ctx.strokeRect(0,0,this.attr('width'),this.attr('height'));
					this.ctx.fillStyle=this.color;
					this.points.each(function(point){
						this.ctx.fillRect(point.attr('x'),point.attr("y"),5,5);
					},this);
				},
				color:"green",
				mousedown:function(evt){
					if(evt.right){
						var m=new OBMenu([
							"Clear",
							"Print Selected Color",
							"Print All Colors",
							"Copy Data URL"
						]);
						m.observe("selected",function(x){
							if(x=="Copy Data URL"){
								OBCopy(click.toDataURL());
							}else if(x=="Print Selected Color"){
								var c=new Clicker(null,click.attr("frame"));
								c.color=click.color;
								c.points=click.points;
								c.update();
								OBView.print([c],"One Color");
							}else if(x=="Print All Colors"){
								var arr=[];
								var colors=[
									"green",
									"blue",
									"purple",
									"yellow",
									"orange",
									"black"
								];
								for(var i=0;i<colors.length;i++){
									var c=new Clicker(null,click.attr("frame"));
									c.color=colors[i];
									c.points=click.points;
									c.update();
									arr.push(c);
								}
								OBView.print(arr,"All Colors");
							}else if(x=="Clear"){
								click.points=[];
								click.update();
							}
						});
						this.m=m;
					}else{
						this.points.push(evt.point);
						this.update();
					}
				},
				mousedrag:function(evt){
					this.mousedown(evt);
				},
				mousewheel:function(evt){
					console.info(evt);
				},
				dblclick:function(evt){
					alert(evt.point);
				},
				mouseup:function(evt){
					if(this.m){
						var o=evt.point.clone();
						o.add(this.getGlobalOrigin());
						this.m.show(new OBRect(o,new OBSize(200,300)));
						this.m=null;
					}
				}//,
				//mouseover:function(){console.info("mouseover");},
				//mouseout:function(){console.info("mouseout");}
			});
			function testAnim(){
				var a=new OBViewAnimation(window.z);
				a.attr("x",50);
				a.attr("y",50);
				a.attr("width",500);
				a.attr("opacity",0.5);
				a.attr("rotation",(45).toRadians());
				a.duration=3;
				a.observe("finished",function(){
					console.info("Finished Animation");
				});
				a.start();
			}
			document.observe("theme:loaded",function(){
				window.z=new WeirdView(null,new OBRect(10,10,300,300));
				window.click=new Clicker(window.z,new OBRect(90,90,200,200));
				click.attr("autoresize",OBView.Autoresize.Width|OBView.Autoresize.Height|OBView.Autoresize.LockBottomRight);
				window.tf=new OBSearchField(null,new OBRect(300,320,500,24));
				tf.observe("trigger",function(){
					alert("Hello "+tf.attr("text"));
				});
				window.img=new OBImageView(null, new OBRect(300,400,100,100));
				window.Tux=new Image();
				Tux.onload=function(){
					img.attr("image",Tux);
				};
				Tux.src="http://commons.wikimedia.org/w/thumb.php?f=Tux.svg&width=200px";
				window.scrollbar=new OBScrollBar(null, new OBRect(600,400,200,17),10);
				window.cb=new OBButton(null, new OBRect(10,400,0,0),"Actions");
				cb.observe("click",function(){
					var m=new OBMenu([
						"Clear",
						"Print Selected Color",
						"Print All Colors"
					]);
					m.observe("selected",function(x){
						if(x=="Print Selected Color"){
							var c=new Clicker(null,click.attr("frame"));
							c.color=click.color;
							c.points=click.points;
							c.update();
							OBView.print([c],"One Color");
						}else if(x=="Print All Colors"){
							var arr=[];
							var colors=[
								"green",
								"blue",
								"purple",
								"yellow",
								"orange",
								"black"
							];
							for(var i=0;i<colors.length;i++){
								var c=new Clicker(null,click.attr("frame"));
								c.color=colors[i];
								c.points=click.points;
								c.update();
								arr.push(c);
							}
							OBView.print(arr,"All Colors");
						}else if(x=="Clear"){
							click.points=[];
							click.update();
						}
					});
					m.show(new OBRect(cb.attr("x"),cb.attr("y")-200,0,200));
				});
				window.b=new OBButton(null,new OBRect(500,500,0,0),"green");
				b.observe("click",function(){
					var m=new OBMenu([
						"green",
						"blue",
						"purple",
						"yellow",
						"white"
					]);
					m.observe("selected",function(x){
						b.attr("label",x);
						click.color=x;
						click.update();
						b.sizeToFit();
					});
					m.show(new OBRect(500,b.attr("y")-200,100,200));
				});
			});
		</script>
	</head>
	<body>
		<div style="text-align:center">
			LOADING...
		</div>
	</body>
</html>